NOW=$(date +"%m-%d-%Y")
VERSION=0.1.0_mini


NANO_NAME=APUJ
NANO_SRC=/usr/src
NANO_KERNEL=KERNELX64x
NANO_IMAGES=2
NANO_IMGNAME="APUJ_$VERSION.img"
NANO_DRIVE=ada0		# SSD

######################################
NANO_MAKE="make -j 8"

NANO_BOOTLOADER="boot/boot0"
NANO_BOOTCFG="-o nopacket -s 1 -m 3"

#  APU  Disksize
NANO_MEDIASIZE=1250000 		# 6GB gesamt Speicher (1 Image)

NANO_HEADS=16
NANO_SECTS=63
NANO_RAM_ETCSIZE=78128		# 40 MB /etc
NANO_RAM_TMPVARSIZE=500000	# 256 MB /var

CONF_INSTALL='
	# WITHOUT_ACCT=YES
	# WITHOUT_ACPI=YES
WITHOUT_AMD=YES
	# WITHOUT_APM=YES
WITHOUT_ASSERT_DEBUG=YES
WITHOUT_AT=YES
   	# WITHOUT_ATM=YES
WITHOUT_AUDIT=YES
WITHOUT_AUTHPF=YES
WITHOUT_AUTOFS=YES
WITHOUT_BHYVE=YES
WITHOUT_BINUTILS=YES
WITHOUT_BINUTILS_BOOTSTRAP=YES
	# WITHOUT_BLACKLIST=YES
	# WITHOUT_BLACKLIST_SUPPORT=YES
	# WITHOUT_BLACKLIST_SUPPORT=YES
WITHOUT_BLUETOOTH=YES
	# WITHOUT_BOOT=YES
	# WITHOUT_BOOTPARAMD=YES
	# WITHOUT_BOOTPD=YES
WITHOUT_BSDINSTALL=YES	# Test pkg
WITHOUT_BSD_CPIO=YES
	# WITHOUT_BSNMP		# install World=YES
	# WITHOUT_BZIP2=YES
	# WITHOUT_BZIP2_SUPPORT=YES
WITHOUT_CALENDAR=YES
	# WITHOUT_CAPSICUM=YES
	# WITHOUT_CASPER=YES
WITHOUT_CCD=YES
   	# WITHOUT_CDDL=YES
	# WITHOUT_CTF=YES
	# WITHOUT_ZFS=YES
	# WITHOUT_CLANG=YES
	# WITHOUT_CLANG_EXTRAS=YES
	# WITHOUT_CLANG_FULL=YES
WITHOUT_CLANG_BOOTSTRAP=YES
WITHOUT_CLANG_FULL=YES
WITHOUT_CLANG_IS_CC=YES
WITHOUT_CPP=YES
	# WITHOUT_CROSS_COMPILER=YES
	# WITHOUT_BINUTILS_BOOTSTRAP=YES
	# WITHOUT_CLANG_BOOTSTRAP=YES
	# WITHOUT_ELFTOOLCHAIN_BOOTSTRAP=YES
	# WITHOUT_GCC_BOOTSTRAP=YES
	# WITHOUT_CRYPT=YES
	# WITHOUT_KERBEROS=YES
	# WITHOUT_KERBEROS_SUPPORT=YES
	# WITHOUT_OPENSSH=YES
	# WITHOUT_OPENSSL=YES
	# WITHOUT_GSSAPI (unless WITH_GSSAPI is set explicitly)=YES
WITHOUT_CTM=YES
WITHOUT_CUSE=YES
  	# WITHOUT_CXX=YES
	# WITHOUT_CLANG=YES
	# WITHOUT_CLANG_EXTRAS=YES
	# WITHOUT_CLANG_FULL=YES
	# WITHOUT_GNUCXX=YES
	# WITHOUT_GROFF=YES
WITHOUT_DEBUG_FILES=YES
WITHOUT_DICT=YES
	# WITHOUT_SYSTEM_COMPILER (unless WITH_SYSTEM_COMPILER is set=YES
	# WITH_AUTO_OBJ (unless WITHOUT_AUTO_OBJ is set explicitly)=YES
	# WITH_META_MODE (unless WITHOUT_META_MODE is set explicitly)=YES
	# WITH_STAGING (unless WITHOUT_STAGING is set explicitly)=YES
	# WITH_STAGING_MAN (unless WITHOUT_STAGING_MAN is set explicitly)=YES
	# WITH_STAGING_PROG (unless WITHOUT_STAGING_PROG is set explicitly)=YES
	# WITH_SYSROOT (unless WITHOUT_SYSROOT is set explicitly)=YES
WITHOUT_DMAGENT=YES
WITHOUT_DOCCOMPRESS=YES
WITHOUT_DYNAMICROOT=YES
	# WITHOUT_ED_CRYPTO=YES
WITHOUT_EE=YES
	# WITHOUT_ELFCOPY_AS_OBJCOPY=YES
	# WITHOUT_ELFTOOLCHAIN_BOOTSTRAP=YES
WITHOUT_EXAMPLES=YES
WITHOUT_FDT=YES
	# WITHOUT_FILE=YES		# fur NANO benotigt !!!!
	# WITHOUT_FINGER=YES
WITHOUT_FLOPPY=YES
	# WITHOUT_FMTREE=YES		# mtree (IDS)
WITHOUT_FORMAT_EXTENSIONS=YES
	# WITHOUT_FORTH=YES		#freeBSD 11.2 bootloader
	# WITHOUT_FP_LIBC=YES
WITHOUT_FREEBSD_UPDATE=YES
WITHOUT_FTP=YES
WITHOUT_GAMES=YES
WITHOUT_GCC=YES 
WITHOUT_GCC_BOOTSTRAP=YES 
  	# WITHOUT_GCOV=YES
WITHOUT_GDB=YES
	# WITHOUT_GNU=YES
	# WITHOUT_GNU_SUPPORT=YES
WITHOUT_GNUCXX=YES
WITHOUT_GNU_GREP_COMPAT=YES
WITHOUT_GNU_SUPPORT=YES
	# WITHOUT_GPIO=YES
	# WITHOUT_GPL_DTC=YES
   	# WITHOUT_GROFF=YES
	# WITHOUT_GSSAPI		# Build World=YES
WITHOUT_HAST=YES
WITHOUT_HTML=YES
WITHOUT_HYPERV=YES
WITHOUT_ICONV=YES
	# WITHOUT_INCLUDES=YES
	# WITHOUT_INET=YES
	# WITHOUT_INET_SUPPORT=YES
	# WITHOUT_INET6=YES
	# WITHOUT_INET6_SUPPORT=YES
	# WITHOUT_INETD=YES
WITHOUT_INSTALLLIB=YES	# Test NANO 4
	# WITHOUT_IPFILTER=YES
	# WITHOUT_IPFW=YES
WITHOUT_ISCSI=YES
	# WITHOUT_JAIL=YES
WITHOUT_KDUMP=YES
   	# WITHOUT_KERBEROS=YES
	# WITHOUT_KERBEROS_SUPPORT=YES
	# WITHOUT_GSSAPI (unless WITH_GSSAPI is set explicitly)=YES
   	# WITHOUT_KERBEROS_SUPPORT=YES
WITHOUT_KERNEL_SYMBOLS=YES
	# WITHOUT_KVM		# Build World=YES
	# WITHOUT_KVM_SUPPORT=YES
	# WITHOUT_LDNS=YES	# SSH benotigt
	# WITHOUT_LDNS_UTILS=YES
	# WITHOUT_UNBOUND=YES
WITHOUT_LEGACY_CONSOLE=YES
 	# WITHOUT_LIB32=YES
    	# WITHOUT_LIBCPLUSPLUS=YES
	# WITHOUT_LIBPTHREAD		# Build World=YES
	# WITHOUT_LIBTHR=YES
WITHOUT_LLDB=YES
	# WITHOUT_LLVM_LIBUNWIND=YES
    	# WITHOUT_LOCALES=YES
WITHOUT_LOCATE=YES
WITHOUT_LPR=YES
	# WITHOUT_LS_COLORS=YES
	# WITHOUT_LZMA_SUPPORT=YES
   	# WITHOUT_MAIL=YES	# fur FAX Betrieb notwendig
	# WITHOUT_DMAGENT=YES
	# WITHOUT_MAILWRAPPER=YES
	# WITHOUT_SENDMAIL=YES
WITHOUT_MAKE=YES 
WITHOUT_MAN=YES
	# WITHOUT_MAN_UTILS (unless WITH_MAN_UTILS is set explicitly)=YES
WITHOUT_MANCOMPRESS=YES
WITHOUT_MANDOCDB=YES
	# Currently this also enforces WITHOUT_SYSTEM_COMPILER.  When set,=YES
	# WITHOUT_SYSTEM_COMPILER (unless WITH_SYSTEM_COMPILER is set=YES
    	# WITHOUT_NDIS=YES		#TEST
	# WITHOUT_NETCAT=YES
	# WITHOUT_NETGRAPH		# Build World=YES
	# WITHOUT_ATM=YES
	# WITHOUT_BLUETOOTH=YES
	# WITHOUT_NETGRAPH_SUPPORT=YES
	# WITHOUT_NETGRAPH_SUPPORT=YES
    	# WITHOUT_NIS=YES
WITHOUT_NLS=YES
WITHOUT_NLS_CATALOGS=YES
WITHOUT_NS_CACHING=YES
	# WITHOUT_NTP=YES				# Openntpd
	# WITHOUT_OPENSSH=YES
	# WITHOUT_OPENSSL=YES
	# WITHOUT_KERBEROS=YES
	# WITHOUT_KERBEROS_SUPPORT=YES
	# WITHOUT_OPENSSH=YES
	# WITHOUT_GSSAPI (unless WITH_GSSAPI is set explicitly)=YES
    	# WITHOUT_PAM=YES
	# WITHOUT_PAM_SUPPORT=YES
WITHOUT_PC_SYSINSTALL=YES
WITHOUT_PF=YES
	# WITHOUT_AUTHPF=YES
 	# WITHOUT_PKGBOOTSTRAP=YES	# wichtig fur PKG install xxx
WITHOUT_PMC=YES
WITHOUT_PORTSNAP=YES
WITHOUT_PPP=YES
    	# WITHOUT_PROFILE=YES
WITHOUT_QUOTAS=YES
WITHOUT_RADIUS_SUPPORT=YES
	# WITHOUT_RBOOTD=YES
WITHOUT_RCMDS=YES
WITHOUT_RCS=YES
WITHOUT_RESCUE=YES
WITHOUT_ROUTED=YES
	# WITHOUT_SENDMAIL=YES
WITHOUT_SETUID_LOGIN=YES
WITHOUT_SHAREDOCS=YES
WITHOUT_SOURCELESS=YES
	# WITHOUT_SOURCELESS_HOST=YES
	# WITHOUT_SOURCELESS_UCODE=YES
WITHOUT_SSP=YES
	# WITH_STAGING_MAN (unless WITHOUT_STAGING_MAN is set explicitly)=YES
	# WITH_STAGING_PROG (unless WITHOUT_STAGING_PROG is set explicitly)=YES
WITHOUT_SVNLITE=YES
	# WITHOUT_SYMVER			#Build World=YES
WITHOUT_SYSCONS=YES
WITHOUT_SYSTEM_COMPILER=YES
	# only for building one for the build itself.  The WITHOUT_CLANG=YES
	# and WITHOUT_GCC options control those.=YES
WITHOUT_TALK=YES
WITHOUT_TCP_WRAPPERS=YES
	# WITHOUT_TCSH=YES
WITHOUT_TELNET=YES
WITHOUT_TESTS=YES
	# WITHOUT_DTRACE_TESTS=YES
	# WITHOUT_TESTS_SUPPORT=YES
WITHOUT_TESTS_SUPPORT=YES
WITHOUT_TEXTPROC=YES
	# WITHOUT_GROFF=YES
	# WITHOUT_TFTP=YES
WITHOUT_TIMED=YES
WITHOUT_TOOLCHAIN=YES
	# WITHOUT_BINUTILS=YES
	# WITHOUT_CLANG=YES
	# WITHOUT_CLANG_EXTRAS=YES
	# WITHOUT_CLANG_FULL=YES
	# WITHOUT_GCC=YES
	# WITHOUT_GDB=YES
	# WITHOUT_INCLUDES=YES
	# WITHOUT_LLDB=YES
WITHOUT_UNBOUND=YES
	# WITHOUT_USB=YES
WITHOUT_USB_GADGET_EXAMPLES=YES
	# WITHOUT_UTMPX=YES
WITHOUT_VI=YES
WITHOUT_WARNS=YES
WITHOUT_WIRELESS=YES
	# WITHOUT_WIRELESS_SUPPORT=YES
WITHOUT_WPA_SUPPLICANT_EAPOL=YES
	# WITHOUT_ZFS=YES
	# WITHOUT_ZONEINFO=YES

########### WITH ################

'

########### WITH ################

cust_nobeastie() (
	touch ${NANO_WORLDDIR}/boot/loader.conf
	echo "beastie_disable=\"YES\"" >> ${NANO_WORLDDIR}/boot/loader.conf
	echo "comconsole_speed=\"115200\"" >> ${NANO_WORLDDIR}/boot/loader.conf
	echo "boot_silent=\"YES\"" >> ${NANO_WORLDDIR}/boot/loader.conf
	echo "kern.cam.boot_delay=\"5000\"" >> ${NANO_WORLDDIR}/boot/loader.conf
	
	)

cust_install() (


	cp /etc/resolv.conf ${NANO_WORLDDIR}/etc/
	
	pkg -c ${NANO_WORLDDIR} update
	pkg -c ${NANO_WORLDDIR} upgrade
	pkg -c ${NANO_WORLDDIR} install -y nano
	pkg -c ${NANO_WORLDDIR} install -y monit
	pkg -c ${NANO_WORLDDIR} install -y dmidecode 
	pkg -c ${NANO_WORLDDIR} install -y screen
	pkg -c ${NANO_WORLDDIR} install -y htop
	pkg -c ${NANO_WORLDDIR} install -y iftop
	pkg -c ${NANO_WORLDDIR} install -y bmon
	pkg -c ${NANO_WORLDDIR} install -y aide
	pkg -c ${NANO_WORLDDIR} install -y logrotate
	pkg -c ${NANO_WORLDDIR} install -y sendxmpp
	pkg -c ${NANO_WORLDDIR} install -y net-snmp
	pkg -c ${NANO_WORLDDIR} install -y iperf
	pkg -c ${NANO_WORLDDIR} install -y cryptcat
	pkg -c ${NANO_WORLDDIR} install -y openvpn

	############### openntpd ##################################
	pkg -c ${NANO_WORLDDIR} install -y openntpd

	############### zabbix4-agent  ##################
	pkg -c ${NANO_WORLDDIR} install -y zabbix4-agent

	mkdir ${NANO_WORLDDIR}/etc/zabbix
	openssl rand -hex 24 >> ${NANO_WORLDDIR}/etc/zabbix/key.psk
	chown zabbix:zabbix ${NANO_WORLDDIR}/etc/zabbix/key.psk
	chmod 0400 ${NANO_WORLDDIR}/etc/zabbix/key.psk

)


cust_permissions() (
	chmod 700 ${NANO_WORLDDIR}/usr/local/etc/monitrc
	chmod 600 ${NANO_WORLDDIR}/var/account/acct
	chown -R zabbix:zabbix ${NANO_WORLDDIR}/var/run/zabbix/
	rm -r ${NANO_WORLDDIR}/var/cache/pkg
	rm -r ${NANO_WORLDDIR}/var/db/pkg
)

cust_motd(){
        echo "echo \"build from $NOW by ros-it.ch\"" >> ${NANO_WORLDDIR}/usr/local/bin/version
        echo "echo \"Version: $VERSION\"" >> ${NANO_WORLDDIR}/usr/local/bin/version
}

customize_cmd cust_comconsole
customize_cmd cust_allow_ssh_root
customize_cmd cust_nobeastie
#customize_cmd cust_install
#customize_cmd cust_install_files_goibnui
customize_cmd cust_motd
#customize_cmd cust_permissions
